{% extends "shortener/base.html" %}
{% load crispy_forms_tags %}
{% block content %}

  <div id="content-section">
        <form method="POST">  
       <div class="form-row  align-items-center">     
            {% csrf_token %}  
            <fieldset class="col-md-10">
                {{ form|crispy }}
            </fieldset> 
            <div class="col">
                    {% if user.is_authenticated %}
                        <button class="btn btn-outline-info" type="submit">Сократить ссылку</button>
                    {% else %} 
                        <button id="popoverId" class="btn btn-outline-info">Сократить ссылку</button>    
                        <div id="popoverContent" class="d-none">
                            Войдите, чтобы сократить ссылку
                        <a href="{% url 'login' %}">Войти</a>
                        </div>
                    {% endif %}
            </div>
        </div> 
    </form>

 
    





    {% if user.is_authenticated %}
    <table class="table table-condensed" style="border-collapse:collapse;" >
        <thead>
            <tr>
                <th>Original URL</th>
                <th>Short URL</th>
                <th>Created</th>                
                <th>All Clicks</th>
            </tr>
        </thead>
        <tbody>           
            {% for site in site_list %}             
            <tr>
                <td><a href="{{ site.url_original }}">{{ site.url_original }}</a></td>
                <td><a href="{{ site.get_short_url }}">{{ request.get_host }}{{ site.get_short_url }}</a></td>
                <td>{{ site.date_created|date:"F d, Y" }}</td>
                <td>{{ site.clicks }}</td>                  
            </tr>
            {% endfor %} 
        </tbody>     
    </table>  
    {% else %} 

    {% endif %}
    
    <script> 
        $('#popoverId').popover({
            html: true,
            content: $('#popoverContent').html(),
        });
        $('#popoverId').click(function (e) {
            e.stopPropagation();
        });

        $(document).click(function (e) {
            if (($('.popover').has(e.target).length == 0) || $(e.target).is('.close')) {
                $('#popoverId').popover('hide');
            }
        });
    </script> 


{% endblock content %}